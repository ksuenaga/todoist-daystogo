# Todoist Days To Go

Todoistのタスク一覧に、締切/期日までの残り日数を表示するユーザースクリプトです。

[English](README.md) | 日本語 | [中文](README.zh.md)

![スクリーンショット](screenshot.png)

## 機能

- タスクの日付表示の右側に「○日前」「○日後」などを表示
- **常時表示**：マウスホバー状態に関わらずバッジを常に表示
- 残り日数に応じた色分け：
  - 🔴 過去/今日：赤色
  - 🟠 3日以内：オレンジ色
  - 🔵 1週間以内：青色
  - ⚫ それ以上：グレー
- **多言語対応**：日本語、英語、中国語
- **正確な計算**：適切な四捨五入により正確な日数を表示

## インストール

### 1. Tampermonkey をインストール

Chrome ウェブストアから [Tampermonkey](https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo) をインストールしてください。

### 2. ユーザースクリプトをインストール

以下のいずれかの方法でインストールできます：

#### 方法A：直接インストール

1. [todoist-days-to-go.user.js](./todoist-days-to-go.user.js) を開く
2. 「Raw」ボタンをクリック
3. Tampermonkey のインストール画面が表示されるので「インストール」をクリック

#### 方法B：手動インストール

1. Tampermonkey のダッシュボードを開く（ブラウザのツールバーアイコン → ダッシュボード）
2. 「+」タブをクリックして新しいスクリプトを作成
3. [todoist-days-to-go.user.js](./todoist-days-to-go.user.js) の内容をコピー＆ペースト
4. Ctrl+S（Macの場合はCmd+S）で保存

## 使い方

インストール後、Todoistを開くと自動的に動作します。

## カスタマイズ

スクリプト冒頭の `CONFIG` オブジェクトで設定を変更できます：

```javascript
const CONFIG = {
    // 言語：'ja'（日本語）、'en'（英語）、'zh'（中国語）
    language: 'ja',
    // 表示形式：'before'、'after'、'D-'
    format: 'before',
    // 更新間隔（ミリ秒）
    updateInterval: 1000,
    // デバッグモード（コンソールにログを出力）
    debug: false
};
```

### 言語オプション

| language | 表示例 |
|----------|--------|
| `'ja'` | 3日前、今日、3日後 |
| `'en'` | 3d ago、Today、in 3d |
| `'zh'` | 3天前、今天、3天后 |

### 表示形式オプション

| format | 過去 | 今日 | 未来 |
|--------|------|------|------|
| `'before'` | 3日前 | 今日 | 3日後 |
| `'after'` | 3日前 | 今日 | あと3日 |
| `'D-'` | 3日前 | 今日 | D-3 |

## トラブルシューティング

### バッジが表示されない場合

1. Tampermonkey が有効になっているか確認
2. todoist.com でスクリプトが有効になっているか確認（Tampermonkeyアイコン → 該当スクリプトにチェック）
3. ページをリロード
4. `CONFIG.debug = true` にしてコンソールログを確認

### Todoistの更新で動作しなくなった場合

TodoistのDOM構造が変更された可能性があります。Issue を立てていただければ対応します。

## 技術的な仕組み

1. MutationObserver でDOM変更をリアルタイムに監視
2. タスク要素から日付情報を抽出（複数の方法でフォールバック）
3. 今日との日数差を正確な四捨五入（Math.round）で計算
4. insertAdjacentElement を使用して日付要素の隣に永続的なバッジを挿入
5. CSS配置によりホバー状態に関わらずバッジの可視性を維持

## 開発

### テストの実行

このプロジェクトには100%のコードカバレッジを持つ包括的なテストスイートが含まれています。

```bash
# 依存関係のインストール
npm install

# テストの実行
npm test

# カバレッジレポート付きでテストを実行
npm run test:coverage

# ウォッチモードでテストを実行
npm run test:watch
```

### テストカバレッジ

- **ステートメント**: 100% (72/72)
- **ブランチ**: 93.18% (41/44)
- **関数**: 100% (22/22)
- **行**: 100% (71/71)

テストスイートには73の包括的なテストが含まれており、以下をカバーしています：
- すべての言語フォーマット（日本語、英語、中国語）
- 日付の解析と計算
- 色のロジック
- テキストフォーマット
- エッジケースとエラーハンドリング

## 最近の更新

### バージョン 1.1.2
- マウスホバー時にバッジが消える問題を修正
- 永続的な表示のための要素ターゲティングを改善
- 可視性のためのCSSに!importantフラグを追加

### バージョン 1.1.1
- 不正確な日数計算を修正（Math.ceil から Math.round に変更）
- より正確な「残り日数」カウント

### バージョン 1.1.0
- 包括的なテストスイートを追加
- コード品質と信頼性を向上

## ライセンス

MIT License

## 貢献

Issue や Pull Request を歓迎します！PRを提出する前にテストが通過することを確認してください。

### 貢献前のテスト実行

```bash
npm install
npm test
```